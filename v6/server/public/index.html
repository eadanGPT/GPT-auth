
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin</title>
  <style>
    body{font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:2rem;}
    #login{max-width:320px; margin:auto;}
    #panel{display:none;}
    table{border-collapse:collapse; width:100%;}
    th,td{border:1px solid #ddd; padding:8px; text-align:left;}
    th{background:#f5f5f5;}
  </style>
</head>
<body>
  <div id="login">
    <h2>Admin login</h2>
    <input type="password" id="pw" placeholder="Password"/>
    <button onclick="login()">Login</button>
    <div id="msg"></div>
  </div>
  <div id="panel">
    <h2>Active Connections</h2>
    <table id="tbl"><thead><tr><th>Session</th><th>Key</th><th>IP</th><th>Solved</th><th>Failed</th></tr></thead><tbody></tbody></table>
  </div>
  <script>
    async function login(){
      const pw = document.getElementById('pw').value;
      const res = await fetch('/admin/login',{method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({password:pw})});
      if((await res.json()).ok){ document.getElementById('login').style.display='none'; document.getElementById('panel').style.display='block'; load(); }
      else document.getElementById('msg').textContent='Denied';
    }
    async function load(){
      const res = await fetch('/admin/api/active');
      const list = await res.json();
      const tbody = document.querySelector('#tbl tbody'); tbody.innerHTML='';
      for(const s of list){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s.id}</td><td>${s.keyhash}</td><td>${s.ip}</td><td>${s.challenges_solved}</td><td>${s.challenges_failed}</td>`;
        tbody.appendChild(tr);
      }
      setTimeout(load, 5000);
    }
  </script>
</body>
</html>
